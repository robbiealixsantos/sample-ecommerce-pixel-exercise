{% extends "layout.html" %}
{% block content %}
<div class="grid grid-cols-1 md:grid-cols-2 gap-8">
  <div><img src="{{ product.image_url }}" alt="{{ product.name }}" class="rounded-2xl w-full h-auto object-cover"></div>
  <div>
    <h1 class="text-3xl font-bold mb-2">{{ product.name }}</h1>
    <p class="text-gray-600 mb-4">{{ product.description }}</p>
    <div class="text-2xl font-semibold mb-6">{{ product.price_display() }}</div>
    <form action="{{ url_for('add_to_cart') }}" method="post" class="flex items-center space-x-3">
      <input type="hidden" name="product_id" value="{{ product.id }}">
      <input type="number" name="quantity" min="1" value="1" class="w-20 border rounded-lg px-3 py-2">
      <button class="px-4 py-2 rounded-lg bg-gray-900 text-white">Add to Cart</button>
    </form>
  </div>
</div>
{% endblock %}

<script>
(function(){
  var pid={{ product.id }}; var pname={{ product.name|tojson }}; var price={{ product.price_cents }}/100.0;
  var payload={
    content_id:String(pid), item_id:String(pid), content_ids:[String(pid)],
    content_type:'product', content_name:pname, price: price, value: price, currency: window.PIXELS.currency
  };
  fbq('track','ViewContent', payload);
  ttq.track('ViewContent', payload);
  snaptr('track','VIEW_CONTENT'); // Snap: no ids/values/PII

  var form=document.querySelector('form[action="{{ url_for("add_to_cart") }}"]');
  if(form){ form.addEventListener('submit', function(){
    var qty=parseInt(form.querySelector('input[name="quantity"]').value||'1',10);
    var p2=Object.assign({}, payload, {quantity: qty});
    fbq('track','AddToCart', p2);
    ttq.track('AddToCart', p2);
    snaptr('track','ADD_TO_CART'); // Snap: no ids/values/PII
  });}
})();
</script>
